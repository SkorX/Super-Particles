/* -----------------------------------------------
/* Author: Artur Zoremba (Skor_X) - skorx.ga
/* MIT license: http://opensource.org/licenses/MIT
/* GitHub: https://github.com/SkorX/Super-Particles
/* Page: https://skorx.github.io/Super-Particles
/* v0.2.0
/* ----------------------------------------------- */

// --- FULL OPTIONS EXPLANATION (with default values) (do not uncomment this code, preview only) ---
// {
//     particles: {
//         count:                       0,              (number)
//         properties: {
//             shape: {
//                 type:                "none",         (string, ("none" || "circle" || "square"))
//                 size:                25,             (number)
//                 color:               "#FFFFFF",      (string, [#colorString])
//                 stroke: {
//                     width:           0,              (number)
//                     color:           "#000000",      (string, [#colorString])
//                 }
//             }
//             image: {
//                 data:                undefined,      (undefined || HTMLImageElement)
//                 size:                15,             (number)
//                 opacity:             1,              (number, (0 < val <= 1))
//             }
//             motion: {
//                 speed:               8,              (number, (0 <= val))
//                 min_speed:           undefined,      (number, val < speed)
//                 bouncing:            true,           (boolean)
//                 slowDownOnCollision: false,          (boolean)
//                 vx:                  undefined,      (undefined || number, number: (0 < val <= 1))
//                 vy:                  undefined,      (undefined || number, number: (0 < val <= 1))
//                 vx_min:              undefined,      (undefined || number, number: (0 < val <= 1))
//                 vy_min:              undefined,      (undefined || number, number: (0 < val <= 1))
//             }
//             opacity: {
//                 value:               1,              (number, (0 < val <= 1))
//                 alternation: {
//                     enabled:         true,           (boolean)
//                     speed:           1,              (number)
//                     min_value:       0,              (number)
//                 }
//             }
//         }
//     }
//     linking: {
//         enabled:                     true,           (boolean)
//         max_distance:                150,            (numbar)
//         color:                       "#FFFFFF",      (string, [#colorString])
//         width:                       1.5,            (number)
//         opacity:                     0.6,            (number, (0 < val <= 1))
//     }
//     attraction: {
//         enabled:                     true            (boolean)
//         rotateX:                     500,            (numbar)
//         rotateY:                     500,            (numbar)
//     }
// }

var Images={getCanvasForImage:function(e){if(!(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("Can't convert image, because it is in wrong format.");var t=document.createElement("canvas"),a=t.getContext("2d");if(e instanceof HTMLCanvasElement)t.width=e.width,t.height=e.height;else if(e instanceof HTMLImageElement){if(!1===e.complete||void 0===e.naturalWidth||0===e.naturalWidth)throw new Error("Passed image is broken.");t.width=e.naturalWidth,t.height=e.naturalHeight}else if(e instanceof HTMLVideoElement){if(void 0===e.videoWidth||0===e.videoWidth)throw new Error("Passed video is broken.");t.width=e.videoWidth,t.height=e.videoHeight}a.drawImage(e,0,0);try{a.getImageData(0,0,1,1)}catch(e){if("SecurityError"===e.name)throw new TaintedImageError("Loaded image causes security errors. Load image from the same domain or allow for cross-origin data.")}return t},convertImage:function(e,t,a){if(!(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||!1!==imgFromStr))throw new Error("Can't convert image, because it is in wrong format.");if(t!==HTMLCanvasElement&&t!==HTMLImageElement&&t!==Image)throw new Error("Can't convert image, because targetType is incorrect.");var r=Images.getCanvasForImage(e);if(t===HTMLCanvasElement)setTimeout(function(){a.call(this,r)}.bind(Images));else if(t===HTMLImageElement||t===Image){var n=new Image(r.width,r.height);n.onload=function(){a.call(Images,n)}.bind(this),n.onerror=function(){throw new Error("While converting an image to HTMLImageElement, error has occured.")},n.src=r.toDataURL()}return Images},getScaledDownImage:function(e,t,a){if(void 0===e||!(e instanceof HTMLCanvasElement))return!1;var r=Images.getCanvasForImage(e);if(e.width>t||e.height>a){var n=e.width/e.height,i=e.width,o=e.height;t<i&&(o=(i=t)*(1/n)),a<o&&(i=(o=a)*n),r.width=i,r.height=o,r.getContext("2d").drawImage(e,0,0,i,o)}return r}};function TaintedImageError(e,t){Error.call(this,e),this.name="TaintedImageError",this.innerError=t}TaintedImageError.prototype=Object.create(Error.prototype),TaintedImageError.prototype.toString=function(){return this.name+': "'+this.message+'"'},Math.sqr=function(e){return e*e},Math.sqr3=function(e){return e*e*e};
var SuperParticle=function(t,i){"use strict";if(!(this instanceof SuperParticle))throw new Error("SuperParticle have to be executed as a class. Use new keyword.");if("object"!=typeof i)throw new Error("Options are not valid object element.");if(this._position={x:void 0,y:void 0},this._movement={vx:void 0,vy:void 0,initialSpeedSqr:void 0},this._gravity={force:0},this._apperance={shape:{type:void 0,size:0,color:void 0,stroke:{width:0,color:void 0}},image:{sourceData:void 0,data:void 0,size:0,opacity:0},opacity:{value:1,alternation:{speed:0,min_value:0}},behavior:{bounce:!0,slowDownOnCollision:!1},_size:0},this.tag=void 0,"string"!=typeof t)throw new Error("Tag have to be a valid string.");return this.tag=t,this._loadOptions(i),this};SuperParticle.prototype.setSpeed=function(t){if(!isFinite(t))throw new Error("Speed have to be finite number.");var i=Math.sqrt(Math.sqr(this._movement.vx)+Math.sqr(this._movement.vy))/t;return this._movement.vx/=i,this._movement.vy/=i,this._movement.initialSpeedSqr=Math.sqr(t),this},SuperParticle.prototype.resetSpeed=function(){var t=Math.sqr(this._movement.vx)+Math.sqr(this._movement.vy),i=Math.sqrt(t/this._movement.initialSpeedSqr);return this._movement.vx/=i,this._movement.vy/=i,this},SuperParticle.prototype.applyForce=function(t,i,e){return e="boolean"==typeof e&&e,isFinite(t)&&isFinite(i)&&(this._movement.vx+=t,this._movement.vy+=i,e&&(this._movement.initialSpeedSqr=Math.sqr(this._movement.vx)+Math.sqr(this._movement.vy))),this},SuperParticle.prototype.size=function(){return this._apperance._size},SuperParticle.prototype.attractTo=function(t){if(0==this._gravity.force||0==t._gravity.force)return this;if(this._position.x===t._position.x&&this._position.y===t._position.y)return this;var i=Math.sqr(this._position.x-t._position.x)+Math.sqr(this._position.y-t._position.y);if(i>Math.SQRT2&&isFinite(i)){var e=this._gravity.force*t._gravity.force/i;if(e<=0&&(e=.01),e<.01||10<e)return this;var s=t._position.x-this._position.x,o=t._position.y-this._position.y,a=Math.sqrt(i);this.applyForce(s/a*(e/this._gravity.force),o/a*(e/this._gravity.force)),t.applyForce(-s/a*(e/t._gravity.force),-o/a*(e/t._gravity.force))}return this},SuperParticle.prototype.update=function(){return this._position.x+=this._movement.vx,this._position.y+=this._movement.vy,this},SuperParticle.prototype.checkPosition=function(t,i){if(!isFinite(t)||!isFinite(i))return this;var e=!1,s=this.size()/2;return this._apperance.behavior.bounce?(this._position.x+s>=t&&0<this._movement.vx?(this._movement.vx=-this._movement.vx,e=!0):this._position.x-s<=0&&this._movement.vx<0&&(this._movement.vx=-this._movement.vx,e=!0),this._position.y+s>=i&&0<this._movement.vy?(this._movement.vy=-this._movement.vy,e=!0):this._position.y-s<=0&&this._movement.vy<0&&(this._movement.vy=-this._movement.vy,e=!0)):(this._position.x-s>=t?(this._position.x=-s,e=!0):this._position.x+s<=0&&(this._position.x=t+s,e=!0),this._position.y-s>=i?(this._position.y=-s,e=!0):this._position.y+s<=0&&(this._position.y=i+s,e=!0)),e&&this._apperance.behavior.slowDownOnCollision&&this.resetSpeed(),this},SuperParticle.prototype.draw=function(t,i){if(void 0!==this._apperance.shape.type&&this._apperance.shape.size&&this._apperance.shape.color){if(t.beginPath(),"circle"===this._apperance.shape.type)t.arc(this._position.x,this._position.y,this._apperance.shape.size/2,0,2*Math.PI);else{var e=this._apperance.shape.size/2;t.rect(this._position.x-e,this._position.y-e,this._apperance.shape.size,this._apperance.shape.size)}t.globalAlpha=this._apperance.opacity,t.fillStyle=this._apperance.shape.color,t.fill(),this._apperance.shape.stroke.width&&this._apperance.shape.stroke.color&&(t.lineWidth=this._apperance.shape.stroke.width,t.strokeStyle=this._apperance.shape.stroke.color,t.stroke())}if(void 0!==this._apperance.image.data&&this._apperance.image.size&&this._apperance.image.opacity){var s=this._apperance.image.data.height/this._apperance.image.data.width,o=this._apperance.image.size*s,a=this._apperance.image.size/2,r=o/2;t.beginPath(),t.globalAlpha=this._apperance.image.opacity,t.imageSmoothingEnabled="boolean"==typeof i&&i,t.drawImage(this._apperance.image.data,this._position.x-a,this._position.y-r,this._apperance.image.size,o)}return this},SuperParticle.prototype._loadOptions=function(t){return void 0!==t},SuperParticle.prototype._recalculateSize=function(){var t=null!=this._apperance.shape.type&&this._apperance.shape.color?this._apperance.shape.size+this._apperance.shape.stroke.width:0,i=null!=this._apperance.image.data&&this._apperance.image.opacity?this._apperance.image.size:0;return this._apperance._size=Math.max(t,i)},SuperParticle.prototype._calculateDistance=function(t,i){return Math.abs(Math.sqrt(Math.sqr(t._position.x-i._position.x)+Math.sqr(t._position.y-i._position.y)))};
var SuperParticles=function(t,i){"use strict";if(!(this instanceof SuperParticles))throw new Error("SuperParticles have to be executed as a class. Use new keyword.");if(!(t instanceof HTMLCanvasElement))throw new Error("Passed canvas element have to be HTMLCanvasElement.");if("object"!=typeof i)throw new Error("Options are not valid object element.");return this._initialized=!1,this._settings={particles:{count:0,properties:{shape:{type:"none",size:25,color:"#FFFFFF",stroke:{width:0,color:"#000000"}},image:{data:void 0,size:15,opacity:1},motion:{speed:8,min_speed:void 0,bouncing:!0,slowDownOnCollision:!1,vx:void 0,vy:void 0,vx_min:void 0,vy_min:void 0},opacity:{value:1,alternation:{enabled:!1,speed:1,min_value:0}}},smoothImages:!1},linking:{enabled:!0,max_distance:150,color:"#FFFFFF",width:1.5,opacity:.6},attraction:{enabled:!0,force:500},background:{color:void 0,image:void 0,imagePosition:{x:0,y:0,width:0,height:0}}},this._canvas={element:void 0,ctx:void 0,width:0,height:0,drawing:{stop:!0,limitTo30FPS:!1,isResizeEventRunning:!1,lastWindowResizeTime:Date.now()}},this._particlesCount=0,this._particles=[],this._callbacks={initialized:[],windowResized:[],diagnostics:[],_initialized:void 0,_windowResized:void 0,_diagnostics:void 0},this._keyboard={queue:[]},this._diagData={fps:0,frame:0,count:0,startTime:Date.now(),_times:[]},this.onInitialized=void 0,this.onWindowResized=void 0,this.onDiagnostics=void 0,this._resizeHandler=function(){this._canvas.drawing.lastWindowResizeTime=Date.now(),this._canvas.drawing.isResizeEventRunning||(this._canvas.drawing.isResizeEventRunning=!0,setTimeout(this._resizeEventProcess,50))}.bind(this),this._resizeEventProcess=function(){if(this._canvas.drawing.isResizeEventRunning&&this._canvas.drawing.lastWindowResizeTime+50>Date.now())setTimeout(this._resizeEventProcess,50);else{if(this._drawing_ClearCanvas(),this._canvas.element.style.boxSizing="content-box",this._canvas.element.style.padding="0",this._canvas.width=this._canvas.element.width=this._canvas.element.offsetWidth,this._canvas.height=this._canvas.element.height=this._canvas.element.offsetHeight,this._settings.background.image){var t=this._canvas.width/this._canvas.height,i=this._settings.background.image.naturalWidth/this._settings.background.image.naturalHeight;if(t==i)this._settings.background.imagePosition={x:0,y:0,width:this._canvas.width,height:this._canvas.height};else if(i<t){var e=Math.round(this._canvas.width/2),s=this._canvas.height/this._settings.background.image.naturalHeight,a=Math.floor(this._settings.background.image.width*s/2);that._.workspace={x:0,leyft:e-a,width:Math.floor(this._settings.background.image.width*s),height:this._canvas.height}}else{var n=Math.round(this._canvas.height/2);s=this._canvas.width/this._settings.background.image.width,a=Math.floor(this._settings.background.image.height*s/2);that._.workspace={x:n-a,y:0,width:that._.canvasSize.width,height:Math.floor(that._.images.workingImg.height*s)}}}for(var o=0;o<this._particles.length;o++)this._particles[o].checkPosition(this._canvas.width,this._canvas.height);this._canvas.element.style.visibility="visible",this._canvas.drawing.isResizeEventRunning=!1,this._handleEvent("windowResized")}}.bind(this),this._keyDownHandler=function(t){this._kc(t)}.bind(this),this._kc=function(t){return this._keyboard.queue.push(t.keyCode),10<this._keyboard.queue.length&&this._keyboard.queue.shift(),"38,38,40,40,37,39,37,39,66,65"===this._keyboard.queue.toString()}.bind(this),this._canvas.element=t,this._canvas.ctx=t.getContext("2d"),this._canvas.width=this._canvas.element.width=this._canvas.element.offsetWidth,this._canvas.height=this._canvas.element.height=this._canvas.element.offsetHeight,this._loadOptions(i),window.addEventListener("keydown",this._keyDownHandler),window.addEventListener("resize",this._resizeHandler),this._resizeHandler(),this._initialized=!0,this.startDrawing(),this};SuperParticles.version={major:0,minor:2,revision:0,beta:!0},SuperParticles.prototype.addParticle=function(t){if(!(t instanceof SuperParticle))throw new Error("Particle have to be a SuperParticle instance.");return this._particles.push(t),this},SuperParticles.prototype.removeParticle=function(t){if(!0===t)return this._particles.pop(),this;if(t instanceof SuperParticle){var i=this._particles.indexOf(t);return-1!==i&&this._particles.splice(i,1),this}throw new Error("Particle have to be a SuperParticle instance.")},SuperParticles.prototype.addEventListener=function(t,i){return"string"!=typeof t||"function"!=typeof i||!t.startsWith("_")&&t in this._callbacks&&this._callbacks[t].push(i),this},SuperParticles.prototype.removeEventListener=function(t,i){if("string"!=typeof t||"function"!=typeof i)return this;if(!t.startsWith("_")&&t in this._callbacks){var e=this._callbacks[t].indexOf(i);-1!==e&&this._callbacks[t].splice(e,1)}return this},SuperParticles.prototype.startDrawing=function(){return this._canvas.drawing.stop&&this._initialized&&(this._canvas.drawing.stop=!1,this._diagData.startTime=Date.now(),this._requestFrame(this._process)),this},SuperParticles.prototype.stopDrawing=function(){return this._canvas.drawing.stop=!0,this},SuperParticles.prototype.getScreenshotData=function(t,i,e){if(!this._initialized)return this._execCallback(t,[!1]),that;var s=this._canvas.element.toDataURL(i,e);return this._execCallback(t,[s]),that},SuperParticles.prototype.getScreenshot=function(i){if("function"!=typeof i)throw new Error("Callback parameter is not a function.");this.getScreenshotData(function(t){if(!1===t)return this._execCallback(i,[!1]),this});var t=document.createElement("img");return t.onload=function(){this._execCallback(i,[t])}.bind(this),t.src=imageData,this},SuperParticles.prototype._loadOptions=function(t){return void 0!==t},SuperParticles.prototype._handleEvent=function(i,e,t,s){if("string"!=typeof i)throw new Error("_handleEvent - Event name have to be a string value.");if(s="boolean"==typeof s&&s,!(t="boolean"==typeof t&&t)){var a="_"+i;a in this._callbacks&&"function"==typeof this._callbacks[a]&&this._callbacks[a].apply(this,e)}if(!s){var n="on"+i.charAt(0).toUpperCase()+i.slice(1);if(i in this._callbacks)for(var o=0;o<this._callbacks[i].length;o++)setTimeout(function(t){this._callbacks[i][t].apply(this,e)}.bind(this),void 0,o);n in this&&"function"==typeof this[n]&&setTimeout(function(){this[n].apply(this,e)}.bind(this))}},SuperParticles.prototype._execCallback=function(t,i){if("function"!=typeof t)throw new Error("Callback parameter is not a function.");try{setTimeout(function(){t.apply(this,i)}.bind(this))}catch(t){console.exception("An error was thrown during callback: "+t.message||t)}},SuperParticles.prototype._requestFrame=function(t){if(window.requestAnimationFrame)window.requestAnimationFrame(t.bind(this));else if(window.mozRequestAnimationFrame)window.mozRequestAnimationFrame(t.bind(this));else if(window.webkitRequestAnimationFrame)window.webkitRequestAnimationFrame(t.bind(this));else if(window.oRequestAnimationFrame)window.oRequestAnimationFrame(t.bind(this));else{if(!window.msRequestAnimationFrame)throw new Error("Can't redraw canvas, because browser do not support any requestAnimationFrame method.");window.msRequestAnimationFrame(t.bind(this))}},SuperParticles.prototype._process=function(){if(!this._canvas.drawing.stop){this._particlesCount=this._particles.length;for(var t=0;t<this._particlesCount;t++){for(var i=t+1;i<this._particlesCount;i++)this._particles[t].attractTo(this._particles[i]);this._particles[t].checkPosition(this._canvas.width,this._canvas.height),this._particles[t].update()}this._drawing_Redraw(),this._drawing_Diagnostic(),this._requestFrame(this._process)}},SuperParticles.prototype._drawing_Redraw=function(){if(!this._canvas.drawing.limitTo30FPS||this._diagData.frame%2==0){this._drawing_ClearCanvas();for(var t=0;t<this._particlesCount;t++){if(this._settings.linking.enabled)for(var i=Math.sqr(this._settings.linking.max_distance),e=t+1;e<this._particlesCount;e++){var s=Math.sqr(this._particles[t]._position.x-this._particles[e]._position.x)+Math.sqr(this._particles[t]._position.y-this._particles[e]._position.y);s<=i&&(this._canvas.ctx.save(),this._canvas.ctx.beginPath(),this._canvas.ctx.moveTo(this._particles[t]._position.x,this._particles[t]._position.y),this._canvas.ctx.lineTo(this._particles[e]._position.x,this._particles[e]._position.y),this._canvas.ctx.lineWidth=this._settings.linking.width,this._canvas.ctx.strokeStyle=this._settings.linking.color,this._canvas.ctx.globalAlpha=this._settings.linking.opacity*(1-s/i),this._canvas.ctx.stroke(),this._canvas.ctx.restore())}this._canvas.ctx.save(),this._particles[t].draw(this._canvas.ctx,this._settings.particles.smoothImages),this._canvas.ctx.restore()}}},SuperParticles.prototype._drawing_ClearCanvas=function(){this._canvas.ctx.save(),this._settings.background.color?(this._canvas.ctx.fillStyle=this._settings.background.color,this._canvas.ctx.globalAlpha=1,this._canvas.ctx.imageSmoothingEnabled=!1,this._canvas.ctx.fillRect(0,0,this._canvas.width,this._canvas.height)):this._canvas.ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._settings.background.image&&this._canvas.ctx.drawImage(this._settings.background.image,this._settings.background.imagePosition.x,this._settings.background.imagePosition.y,this._settings.background.imagePosition.width,this._settings.background.imagePosition.height),this._canvas.ctx.restore()},SuperParticles.prototype._drawing_Diagnostic=function(){if(this._diagData.frame++,!this._canvas.drawing.limitTo30FPS||this._diagData.frame%2==0){this._diagData.count=this._particles.length;for(var t=performance.now();0<this._diagData._times.length&&this._diagData._times[0]<=t-1e3;)this._diagData._times.shift();this._diagData._times.push(t),this._diagData.fps=(this._diagData._times.length/((t-this._diagData._times[0])/1e3)).toFixed(2),this._handleEvent("diagnostics",[{fps:this._diagData.fps,frame:this._canvas.drawing.limitTo30FPS?parseInt(this._diagData.frame/2):this._diagData.frame,count:this._diagData.count,startTime:this._diagData.startTime}])}};
//# sourceMappingURL=super-particles.min.js.map