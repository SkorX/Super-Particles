{"version":3,"sources":["extensions.js","super-particle.js","super-particles.js"],"names":["Images","getCanvasForImage","image","HTMLCanvasElement","HTMLImageElement","HTMLVideoElement","Error","resultCanvas","document","createElement","resultCanvasCtx","getContext","width","height","complete","undefined","naturalWidth","naturalHeight","videoWidth","videoHeight","drawImage","getImageData","e","name","TaintedImageError","convertImage","targetType","callback","Image","moveCanvas","setTimeout","call","this","bind","newImg","onload","onerror","src","toDataURL","getScaledDownImage","imageCanvas","maxWidth","maxHeight","sizeRatio","newWidth","newHeight","getScaledImage","isFinite","ratio","message","innerError","prototype","Object","create","toString","Math","rand","min","max","random","randInt","ceil","floor","sqr","x","cub","SuperParticle","tag","options","_position","y","_movement","vx","vy","initialSpeedSqr","_gravity","force","_apperance","shape","type","size","color","stroke","sourceData","data","opacity","value","alternation","speed","min_value","_size","_behavior","bounce","slowdownOnCollision","_loadOptions","getState","JSON","parse","stringify","position","movement","gravity","apperance","behavior","setSpeed","targetSpeed","divider","sqrt","resetSpeed","currentSpeedSqr","applyForce","changeInitialSpeed","attractTo","other","distanceSqr","SQRT2","gravityForce","abs","xDiff","yDiff","distance","update","checkPosition","canvasWidth","canvasHeight","collision","radius","draw","canvasContext","enableImageSmoothing","beginPath","arc","PI","centerPositionAdjustment","rect","globalAlpha","fillStyle","fill","lineWidth","strokeStyle","targetHeight","centerPosAdjX","centerPosAdjY","imageSmoothingEnabled","shapeType","shapeSize","_recalculateSize","shapeColor","strokeWidth","strokeColor","console","log","imageSize","imageOpacity","collisionSlowdown","imgSize","_calculateDistance","p1","p2","SuperParticles","canvas","_initialized","_settings","particles","count","properties","motion","min_speed","bouncing","slowDownOnCollision","direction","vx_min","vy_min","enabled","smoothImages","linking","max_distance","attraction","background","_imagePosition","_canvas","element","ctx","drawing","stop","limitTo30FPS","isResizeEventRunning","lastWindowResizeTime","Date","now","_particlesCount","_particles","_callbacks","initialized","windowResized","diagnostics","_windowResized","_diagnostics","_keyboard","queue","_diagData","fps","frame","startTime","_times","onInitialized","onWindowResized","onDiagnostics","_resizeHandler","_resizeEventProcess","_drawing_ClearCanvas","style","boxSizing","padding","offsetWidth","offsetHeight","canvasRatio","imageRatio","centerX","round","dimensionMultiplier","halfBackground","centerY","i","length","visibility","_handleEvent","_keyDownHandler","_kc","kbEvent","push","keyCode","shift","window","addEventListener","startDrawing","version","major","minor","revision","beta","addParticle","particle","splice","removeParticle","pop","index","indexOf","event","startsWith","removeEventListener","_requestFrame","_process","stopDrawing","getScreenshotData","format","encoderOptions","_execCallback","that","imgData","getScreenshot","imageData","previousState","_engineState","limit30FPS","_updateParticles","prevState","currentState","countDiff","engineParticles","_getEngineGeneratedParticles","_generateParticle","particlesToRemove","result","particlesImage","backgroundImage","_particlesState","particlesState","eventName","argArray","disableInner","disablePublic","privateName","apply","publicName","charAt","toUpperCase","slice","id","args","exception","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","j","_drawing_Redraw","_drawing_Diagnostic","maxDistanceSqr","save","moveTo","lineTo","restore","fillRect","clearRect","performance","toFixed","parseInt"],"mappings":"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","file":"super-particles.min.js","sourcesContent":["/* -----------------------------------------------\r\n/* Author: Artur Zoremba (Skor_X) - skorx.ga\r\n/* MIT license: http://opensource.org/licenses/MIT\r\n/* GitHub: https://github.com/SkorX/Super-Particles\r\n/* Page: https://skorx.github.io/Super-Particles\r\n/* v0.2.0\r\n/* ----------------------------------------------- */\r\n\r\n// === Images ===\r\nvar Images = {\r\n    /**\r\n     * Converts image of any type (canvas, image, video) into canvas. If image is canvas, it will be copied.\r\n     * \r\n     * @param {(HTMLCanvasElement|HTMLImageElement|HTMLVideoElement)} image - Image to convert.\r\n     * @returns {HTMLCanvasElement} Canvas created for provided image.\r\n     */\r\n    getCanvasForImage: function (image) {\r\n        if (!(image instanceof HTMLCanvasElement) &&\r\n            !(image instanceof HTMLImageElement)  &&\r\n            !(image instanceof HTMLVideoElement))\r\n            throw new Error(\"Can't convert image, because it is in wrong format.\");\r\n\r\n        var resultCanvas    = document.createElement(\"canvas\");\r\n        var resultCanvasCtx = resultCanvas.getContext(\"2d\");\r\n\r\n        if (image instanceof HTMLCanvasElement) {\r\n            resultCanvas.width  = image.width;\r\n            resultCanvas.height = image.height;\r\n        }\r\n        else if (image instanceof HTMLImageElement) {\r\n            if (image.complete === false || image.naturalWidth === undefined || image.naturalWidth === 0)\r\n                throw new Error(\"Passed image is broken.\");\r\n\r\n            resultCanvas.width  = image.naturalWidth;\r\n            resultCanvas.height = image.naturalHeight;\r\n        }\r\n        else if (image instanceof HTMLVideoElement) {\r\n            if (image.videoWidth === undefined || image.videoWidth === 0)\r\n                throw new Error(\"Passed video is broken.\");\r\n\r\n            resultCanvas.width  = image.videoWidth;\r\n            resultCanvas.height = image.videoHeight;\r\n        }\r\n\r\n        resultCanvasCtx.drawImage(image, 0, 0);\r\n\r\n        //checking for tainted canvas\r\n        try {\r\n            resultCanvasCtx.getImageData(0, 0, 1, 1);\r\n        }\r\n        catch (e) {\r\n            if (e.name === \"SecurityError\")\r\n                throw new TaintedImageError(\"Loaded image causes security errors. Load image from the same domain or allow for cross-origin data.\");\r\n        }\r\n\r\n        return resultCanvas;\r\n    },\r\n\r\n    /**\r\n     * Converts image into another type of image and executes callback when finished.\r\n     * \r\n     * @param {(HTMLCanvasElement|HTMLImageElement|HTMLVideoElement)} image - Image to convert.\r\n     * @param {function} targetType - Target type of image to convert to.\r\n     * @param {function} callback - Callback with result of image conversion.\r\n     */\r\n    convertImage: function (image, targetType, callback) {\r\n        if (!(image instanceof HTMLCanvasElement) &&\r\n            !(image instanceof HTMLImageElement)  &&\r\n            !(image instanceof HTMLVideoElement))\r\n            throw new Error(\"Can't convert image, because it is in wrong format.\");\r\n\r\n        if (targetType !== HTMLCanvasElement &&\r\n            targetType !== HTMLImageElement &&\r\n            targetType !== Image)\r\n            throw new Error(\"Can't convert image, because targetType is incorrect.\");\r\n\r\n        var moveCanvas = Images.getCanvasForImage(image);\r\n\r\n        if (targetType === HTMLCanvasElement) {\r\n            setTimeout(function () { callback.call(this, moveCanvas); }.bind(Images));\r\n        }\r\n        else if (targetType === HTMLImageElement || targetType === Image) {\r\n            var newImg = new Image(moveCanvas.width, moveCanvas.height);\r\n            newImg.onload = function () {\r\n                callback.call(Images, newImg);\r\n            }.bind(this);\r\n            newImg.onerror = function () {\r\n                //this should never happen\r\n                throw new Error(\"While converting an image to HTMLImageElement, error has occured.\");\r\n            };\r\n            newImg.src = moveCanvas.toDataURL();\r\n        }\r\n\r\n        return Images;\r\n    },\r\n\r\n    /**\r\n     * Scales down canvas image to target maximal size.\r\n     * \r\n     * @param {HTMLCanvasElement} imageCanvas - Canvas to resize.\r\n     * @param {number} maxWidth - Target max width of new image.\r\n     * @param {number} maxHeight - Target max height of new image.\r\n     */\r\n    getScaledDownImage: function (imageCanvas, maxWidth, maxHeight) {\r\n        if (typeof imageCanvas === \"undefined\" || !(imageCanvas instanceof HTMLCanvasElement))\r\n            return false;\r\n\r\n        //canvas cloning\r\n        var resultCanvas = Images.getCanvasForImage(imageCanvas);\r\n\r\n        if (imageCanvas.width > maxWidth || imageCanvas.height > maxHeight) {\r\n            var sizeRatio = imageCanvas.width / imageCanvas.height;\r\n            var newWidth  = imageCanvas.width;\r\n            var newHeight = imageCanvas.height;\r\n\r\n            if (newWidth > maxWidth) {\r\n                newWidth  = maxWidth;\r\n                newHeight = newWidth * (1 / sizeRatio);\r\n            }\r\n\r\n            if (newHeight > maxHeight) {\r\n                newHeight = maxHeight;\r\n                newWidth  = newHeight * sizeRatio;\r\n            }\r\n\r\n            resultCanvas.width  = newWidth;\r\n            resultCanvas.height = newHeight;\r\n            resultCanvas\r\n                .getContext('2d')\r\n                .drawImage(imageCanvas, 0, 0, newWidth, newHeight);\r\n        }\r\n\r\n        return resultCanvas;\r\n    },\r\n\r\n    /**\r\n     * Scales up or down image to target size or width (height will be calculated by aspect ratio).\r\n     * \r\n     * @param {HTMLCanvasElement} imageCanvas - Canvas to resize.\r\n     * @param {number} width - Target width of rescaled image.\r\n     * @param {number} [height] - Target height of rescaled image (or undefined to keep aspect ratio).\r\n     */\r\n    getScaledImage: function (imageCanvas, width, height) {\r\n        if (typeof imageCanvas === \"undefined\" || !(imageCanvas instanceof HTMLCanvasElement))\r\n            return false;\r\n\r\n        if (!isFinite(width))\r\n            //can't produce scales image (no size), so we clone old image (same size)\r\n            return Images.getCanvasForImage(imageCanvas);\r\n\r\n        var resultCanvas    = document.createElement(\"canvas\");\r\n        \r\n        resultCanvas.width = width;\r\n        if (!isFinite(height)) {\r\n            var ratio = imageCanvas.height / imageCanvas.width;\r\n            resultCanvas.height = width * ratio;\r\n        }       \r\n        else {\r\n            resultCanvas.height = height;\r\n        }\r\n\r\n        resultCanvas\r\n            .getContext('2d')\r\n            .drawImage(imageCanvas, 0, 0, resultCanvas.width, resultCanvas.height);\r\n\r\n        return resultCanvas;\r\n    }\r\n};\r\n\r\nfunction TaintedImageError(message, innerError) {\r\n    Error.call(this, message);\r\n\r\n    this.name       = \"TaintedImageError\";\r\n    this.innerError = innerError;\r\n}\r\nTaintedImageError.prototype = Object.create(Error.prototype);\r\nTaintedImageError.prototype.toString = function () {\r\n    return this.name + ': \"' + this.message + '\"';\r\n}\r\n\r\n// === Math ===\r\n/**\r\n * Returns random number in [min; max) range.\r\n * \r\n * @param {number} min - Minimal value.\r\n * @param {number} max - Maximal value.\r\n */\r\nMath.rand = function (min, max) {\r\n    return (Math.random() * (max - min)) + min;\r\n};\r\n\r\n/**\r\n * Returns random integer number in [min; max] range.\r\n * \r\n * @param {number} min - Minimal value.\r\n * @param {number} max - Maximal value.\r\n */\r\nMath.randInt = function (min, max) {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n/**\r\n * Returns the square of the number.\r\n * \r\n * @param {number} x - Value whose square is computed.\r\n */\r\nMath.sqr = function (x) {\r\n    //Multiplying is much faster then Math.pow function\r\n    return x * x;\r\n};\r\n\r\n/**\r\n * Returns the cubic of the number.\r\n * \r\n * @param {number} x - Value whose cubic is computed.\r\n */\r\nMath.cub = function (x) {\r\n    return x * x * x;\r\n};\r\n","/* -----------------------------------------------\r\n/* Author: Artur Zoremba (Skor_X) - skorx.ga\r\n/* MIT license: http://opensource.org/licenses/MIT\r\n/* GitHub: https://github.com/SkorX/Super-Particles\r\n/* Page: https://skorx.github.io/Super-Particles\r\n/* v0.2.0\r\n/* ----------------------------------------------- */\r\n\r\n// --- OPTIONS EXPLANATION (with default values) (do not uncomment this code, preview only) ---\r\n// {\r\n//     x:                      undefined,          (number)\r\n//     y:                      undefined,          (number)\r\n//\r\n//     vx:                     undefined,          (number)\r\n//     vy:                     undefined,          (number)\r\n//\r\n//     gravityForce:           0,                  (number)\r\n//\r\n//     apperance: {\r\n//         shapeType:          undefined,          (string, (\"none\" | \"circle\" | \"square\"))\r\n//         shapeSize:          0,                  (number, (0 <= val))\r\n//         shapeColor:         undefined           (string, [#colorString])\r\n//\r\n//         strokeWidth:        0,                  (number, (0 <= val))\r\n//         strokeColor:        undefined,          (string, [#colorString])\r\n//\r\n//         image:              undefined,          (undefined | HTMLImageElement)\r\n//         imageSize:          0,                  (number, (0 <= val))\r\n//         imageOpacity:       1,                  (number, (0 <= val <= 1))\r\n//\r\n//         opacity:            1,                  (number, (0 < val <= 1))\r\n//     }\r\n//     behavior: {\r\n//         bounce:             true,               (boolean)\r\n//         collisionSlowdown:  false,              (boolean)\r\n//     }\r\n// }\r\n\r\n\r\nvar SuperParticle = function (tag, options) {\r\n    \"use strict\";\r\n\r\n    //init checks\r\n    if (!(this instanceof SuperParticle))\r\n        throw new Error(\"SuperParticle have to be executed as a class. Use new keyword.\");\r\n\r\n    if (typeof options !== \"object\")\r\n        throw new Error(\"Options are not valid object element.\");\r\n\r\n    //// === PRIVATE VARIABLES ===\r\n    this._position = {              //current particle postion\r\n        x: undefined,\r\n        y: undefined,\r\n    };\r\n\r\n    this._movement = {              //movement vector (velocity)\r\n        vx: undefined,\r\n        vy: undefined,\r\n\r\n        initialSpeedSqr: undefined, //slowdown cached speed (for slowdownOnCollision setting)\r\n    };\r\n\r\n    this._gravity = {\r\n        force: 0,                   //0 means particle has no gravity (no mass)\r\n    };\r\n\r\n    this._apperance = {\r\n        shape: {\r\n            type:  undefined,       //circle | square\r\n            size:  0,\r\n            color: undefined,\r\n            stroke: {\r\n                width: 0,\r\n                color: undefined,\r\n            }\r\n        },\r\n        image: {\r\n            sourceData: undefined,  //HTMLCanvasElement loaded when creating particle\r\n            data:       undefined,  //HTMLCanvasElement optimized for drawing (TODO optimize to target size)\r\n            size:       0,\r\n            opacity:    1,\r\n        },\r\n        opacity: {\r\n            value: 1,\r\n\r\n            alternation: {\r\n                speed:     0,       //change per second\r\n                min_value: 0,\r\n            }\r\n        },\r\n\r\n        _size: 0,\r\n    };\r\n\r\n    this._behavior = {\r\n        bounce:              true,\r\n        slowdownOnCollision: false,\r\n    };\r\n\r\n    //// === PUBLIC VARIABLES ===\r\n    this.tag = undefined;\r\n\r\n    //// === CONSTRUCTOR ===\r\n    if (typeof tag !== \"string\")\r\n        throw new Error(\"Tag have to be a valid string.\");\r\n\r\n    this.tag = tag;\r\n    this._loadOptions(options);\r\n\r\n    return this;\r\n};\r\n\r\n//// === PUBLIC METHODS ===\r\n//state\r\nSuperParticle.prototype.getState = function () {\r\n    return JSON.parse(JSON.stringify({\r\n        position: this._position,\r\n        movement: this._movement,\r\n        gravity: this._gravity,\r\n        apperance: {\r\n            shape: this._apperance.shape,\r\n            image: {\r\n                data: this._apperance.image.sourceData.toDataURL(),\r\n                size: this._apperance.image.size,\r\n                opacity: this._apperance.image.opacity,\r\n            },\r\n            opacity: this._apperance.opacity,\r\n        },\r\n        size: this._apperance._size,\r\n        behavior: this._behavior,\r\n\r\n        tag: this.tag,\r\n    }));\r\n};\r\n\r\n//properties\r\nSuperParticle.prototype.size = function () {\r\n    return this._apperance._size;\r\n};\r\n\r\n//modificators\r\nSuperParticle.prototype.setSpeed = function (targetSpeed) {\r\n    if (!isFinite(targetSpeed))\r\n        throw new Error(\"Speed have to be finite number.\");\r\n\r\n    //calculating current speed & target speed divider\r\n    var currentSpeed = Math.sqrt(Math.sqr(this._movement.vx) + Math.sqr(this._movement.vy));\r\n    var divider = currentSpeed / targetSpeed;\r\n\r\n    //reseting speed \r\n    this._movement.vx /= divider;\r\n    this._movement.vy /= divider;\r\n\r\n    //setting target speed as initial\r\n    this._movement.initialSpeedSqr = Math.sqr(targetSpeed);\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticle.prototype.resetSpeed = function () {\r\n    //calculating current speed square\r\n    var currentSpeedSqr = Math.sqr(this._movement.vx) + Math.sqr(this._movement.vy);\r\n\r\n    //calulating speed difference\r\n    var divider = Math.sqrt(currentSpeedSqr / this._movement.initialSpeedSqr);\r\n\r\n    //reseting speed to initial value\r\n    this._movement.vx /= divider;\r\n    this._movement.vy /= divider;\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticle.prototype.applyForce = function (vx, vy, changeInitialSpeed) {\r\n    changeInitialSpeed = (typeof changeInitialSpeed === \"boolean\") ? changeInitialSpeed : false;\r\n\r\n    if (isFinite(vx) && isFinite(vy)) {\r\n        //applying new movement vector\r\n        this._movement.vx += vx;\r\n        this._movement.vy += vy;\r\n        \r\n        if (changeInitialSpeed)\r\n            this._movement.initialSpeedSqr = Math.sqr(this._movement.vx) + Math.sqr(this._movement.vy);\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\n//processing / drawing\r\nSuperParticle.prototype.attractTo = function (other) {\r\n    //if no force, we do not have to calculate anything\r\n    if (this._gravity.force == 0 || other._gravity.force == 0)\r\n        return this;\r\n\r\n    //if two particles are at the same place, no force can't be applied\r\n    if (this._position.x === other._position.x &&\r\n        this._position.y === other._position.y)\r\n        return this;\r\n\r\n    //distance square\r\n    var distanceSqr =\r\n        Math.sqr(this._position.x - other._position.x) +\r\n        Math.sqr(this._position.y - other._position.y);\r\n\r\n    if (distanceSqr > Math.SQRT2 && isFinite(distanceSqr)) {\r\n        var gravityForce = Math.abs(this._gravity.force * other._gravity.force) / distanceSqr;\r\n\r\n        //let's move objects even when one has no force (it stills should be attracted to each other)\r\n        if (gravityForce <= 0)\r\n            gravityForce = 0.01;\r\n\r\n        //optimization (very low gravity do not change positions significantly, but consumes processing power)\r\n        //skipping high gravity (otherwise objects velocity can grow to extremly high values in a few ticks)\r\n        if (gravityForce < 0.01 || gravityForce > 10)       //10 or 100 is cool (not too high, not too low)\r\n            return this;\r\n\r\n        //calculating postion difference\r\n        var xDiff = other._position.x - this._position.x;\r\n        var yDiff = other._position.y - this._position.y;\r\n\r\n        var distance = Math.sqrt(distanceSqr);\r\n\r\n        this.applyForce(\r\n            ((xDiff / distance) * (gravityForce / this._gravity.force)),\r\n            ((yDiff / distance) * (gravityForce / this._gravity.force)));\r\n\r\n        other.applyForce(\r\n            -((xDiff / distance) * (gravityForce / other._gravity.force)),\r\n            -((yDiff / distance) * (gravityForce / other._gravity.force)));\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticle.prototype.update = function () {\r\n    this._position.x += this._movement.vx;\r\n    this._position.y += this._movement.vy;\r\n\r\n    //TODO opacity alternation\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticle.prototype.checkPosition = function (canvasWidth, canvasHeight) {\r\n    if (!isFinite(canvasWidth) || !isFinite(canvasHeight))\r\n        return this;\r\n\r\n    var collision = false;\r\n    var size = this.size();\r\n    var radius = size / 2;\r\n\r\n    if (this._behavior.bounce) {\r\n        //bouncing handling\r\n        if (this._position.x + radius >= canvasWidth && this._movement.vx > 0) {\r\n            this._movement.vx = -this._movement.vx;\r\n            collision = true;\r\n        }\r\n        else if (this._position.x - radius <= 0 && this._movement.vx < 0) {\r\n            this._movement.vx = -this._movement.vx;\r\n            collision = true;\r\n        }\r\n\r\n        if (this._position.y + radius >= canvasHeight && this._movement.vy > 0) {\r\n            this._movement.vy = -this._movement.vy;\r\n            collision = true;\r\n        }\r\n        else if (this._position.y - radius <= 0 && this._movement.vy < 0) {\r\n            this._movement.vy = -this._movement.vy;\r\n            collision = true;\r\n        }\r\n    }\r\n    else {\r\n        //warp handling (to the oposite edge of canvas)\r\n        if (this._position.x - radius >= canvasWidth) {\r\n            this._position.x = -radius;\r\n            collision = true;\r\n        }\r\n        else if (this._position.x + radius <= 0) {\r\n            this._position.x = canvasWidth + radius;\r\n            collision = true;\r\n        }\r\n\r\n        if (this._position.y - radius >= canvasHeight) {\r\n            this._position.y = -radius;\r\n            collision = true;\r\n        }\r\n        else if (this._position.y + radius <= 0) {\r\n            this._position.y = canvasHeight + radius;\r\n            collision = true;\r\n        }\r\n    }\r\n\r\n    if (collision && this._behavior.slowdownOnCollision)\r\n        this.resetSpeed();\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticle.prototype.draw = function (canvasContext, enableImageSmoothing) {\r\n    //drawing shapes\r\n    if (this._apperance.shape.type !== undefined &&\r\n        this._apperance.shape.size && this._apperance.shape.color) {\r\n\r\n        canvasContext.beginPath();\r\n\r\n        if (this._apperance.shape.type === \"circle\") {\r\n            //circle drawing\r\n            canvasContext.arc(\r\n                this._position.x,\r\n                this._position.y,\r\n                this._apperance.shape.size / 2,\r\n                0,\r\n                2 * Math.PI);\r\n        }\r\n        else {\r\n            //square drawing\r\n            var centerPositionAdjustment = this._apperance.shape.size / 2;\r\n\r\n            canvasContext.rect(\r\n                this._position.x - centerPositionAdjustment,\r\n                this._position.y - centerPositionAdjustment,\r\n                this._apperance.shape.size,\r\n                this._apperance.shape.size);\r\n        }\r\n\r\n        canvasContext.globalAlpha = this._apperance.opacity;\r\n\r\n        canvasContext.fillStyle = this._apperance.shape.color;\r\n        canvasContext.fill();\r\n\r\n        //drawing outline (stroke)\r\n        if (this._apperance.shape.stroke.width && this._apperance.shape.stroke.color) {\r\n            canvasContext.lineWidth = this._apperance.shape.stroke.width;\r\n            canvasContext.strokeStyle = this._apperance.shape.stroke.color;\r\n            canvasContext.stroke();\r\n        }\r\n    }\r\n\r\n    //drawing image\r\n    if (this._apperance.image.data !== undefined &&\r\n        this._apperance.image.size && this._apperance.image.opacity) {\r\n\r\n        var ratio = this._apperance.image.data.height / this._apperance.image.data.width;\r\n        var targetHeight = this._apperance.image.size * ratio;\r\n\r\n        var centerPosAdjX = this._apperance.image.size / 2;\r\n        var centerPosAdjY = targetHeight / 2;\r\n        \r\n        canvasContext.beginPath();\r\n        canvasContext.globalAlpha = this._apperance.image.opacity;\r\n        canvasContext.imageSmoothingEnabled = (typeof enableImageSmoothing === \"boolean\") ? enableImageSmoothing : false;\r\n\r\n        canvasContext.drawImage(\r\n            this._apperance.image.data,\r\n            this._position.x - centerPosAdjX,\r\n            this._position.y - centerPosAdjY,\r\n            this._apperance.image.size,\r\n            targetHeight);\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\n//// === PRIVATE METHODS ===\r\n//options\r\nSuperParticle.prototype._loadOptions = function (options) {\r\n    if (typeof options !== 'object')\r\n        return false;\r\n\r\n    if ('x'             in options && isFinite(options.x))\r\n        this._position.x = options.x;\r\n\r\n    if ('y'             in options && isFinite(options.y))\r\n        this._position.y = options.y;\r\n\r\n    if ('vx'            in options && isFinite(options.vx)) {\r\n        this._movement.vx = options.vx;\r\n        this._movement.initialSpeedSqr = Math.sqr(this._movement.vx) + Math.sqr(this._movement.vy);\r\n    }\r\n\r\n    if ('vy'            in options && isFinite(options.vy)) {\r\n        this._movement.vy = options.vy;\r\n        this._movement.initialSpeedSqr = Math.sqr(this._movement.vx) + Math.sqr(this._movement.vy);\r\n    }\r\n\r\n    if ('gravityForce'  in options && isFinite(options.gravityForce))\r\n        this._gravity.force = options.gravityForce;\r\n\r\n    if (typeof options.apperance === \"object\") {\r\n        //fill\r\n        if ('shapeType'     in options.apperance) {\r\n            if (options.apperance.shapeType === \"circle\" || options.apperance.shapeType === \"square\")\r\n                this._apperance.shape.type = options.apperance.shapeType;\r\n            else if (options.apperance.shapeType === \"none\")\r\n                this._apperance.shape.type = undefined;\r\n        }\r\n\r\n        if ('shapeSize'     in options.apperance && isFinite(options.apperance.shapeSize)) {\r\n            if (options.apperance.shapeSize >= 0) {\r\n                this._apperance.shape.size = options.apperance.shapeSize;\r\n                this._recalculateSize();\r\n            }\r\n        }\r\n\r\n        if ('shapeColor'    in options.apperance && typeof options.apperance.shapeColor === \"string\")\r\n            this._apperance.shape.color = options.apperance.shapeColor;\r\n\r\n        //stroke\r\n        if ('strokeWidth'   in options.apperance && isFinite(options.apperance.strokeWidth)) {\r\n            if (options.apperance.strokeWidth >= 0) {\r\n                this._apperance.shape.stroke.width = options.apperance.strokeWidth;\r\n                this._recalculateSize();\r\n            }\r\n        }\r\n\r\n        if ('strokeColor'   in options.apperance && typeof options.apperance.strokeColor === \"string\")\r\n            this._apperance.shape.stroke.color = options.apperance.strokeColor;\r\n\r\n        //image\r\n        if ('image'         in options.apperance && options.apperance.image instanceof HTMLImageElement) {\r\n            try {\r\n                var image = Images.getCanvasForImage(options.apperance.image);\r\n                this._apperance.image.sourceData = image;\r\n\r\n                if (this._apperance.image.size)\r\n                    this._apperance.image.data = Images.getScaledImage(image, this._apperance.image.size);\r\n            }\r\n            catch (e) {\r\n                //unusable image :(\r\n                console.log(\"Particle image is unusable. Image won't be loaded.\");\r\n            }\r\n        }\r\n\r\n        if ('imageSize'     in options.apperance && isFinite(options.apperance.imageSize)) {\r\n            if (options.apperance.imageSize >= 0) {\r\n                this._apperance.image.size = options.apperance.imageSize;\r\n                this._recalculateSize();\r\n\r\n                if (this._apperance.image.sourceData)\r\n                    this._apperance.image.data = Images.getScaledImage(this._apperance.image.sourceData, this._apperance.image.size);\r\n            }\r\n        }\r\n\r\n        if ('imageOpacity'  in options.apperance && isFinite(options.apperance.imageOpacity)) {\r\n            if (options.apperance.imageOpacity >= 0 && options.apperance.imageOpacity <= 1)\r\n                this._apperance.image.opacity = options.apperance.imageOpacity;\r\n        }\r\n\r\n        //opacity\r\n        if ('opacity'       in options.apperance && isFinite(options.apperance.opacity))\r\n            if (options.apperance.opacity > 0 && options.apperance.opacity <= 1)\r\n                this._apperance.opacity.value = options.apperance.opacity;\r\n    }\r\n\r\n    //behavior\r\n    if (typeof options.behavior === \"object\") {\r\n        if ('bounce'            in options.behavior && typeof options.behavior.bounce === \"boolean\")\r\n            this._behavior.bounce = options.behavior.bounce;\r\n\r\n        if ('collisionSlowdown' in options.behavior && typeof options.behavior.collisionSlowdown === \"boolean\")\r\n            this._behavior.slowdownOnCollision = options.behavior.collisionSlowdown;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nSuperParticle.prototype._recalculateSize = function () {\r\n    var shapeSize = (this._apperance.shape.type != undefined && this._apperance.shape.color) ?\r\n        this._apperance.shape.size + this._apperance.shape.stroke.width : 0;\r\n\r\n    var imgSize = (this._apperance.image.data != undefined && this._apperance.image.opacity) ?\r\n        this._apperance.image.size : 0;\r\n\r\n    return this._apperance._size = Math.max(shapeSize, imgSize);\r\n};\r\n\r\n//utilities\r\nSuperParticle.prototype._calculateDistance = function (p1, p2) {\r\n    return Math.abs(\r\n             Math.sqrt(\r\n               Math.sqr(p1._position.x - p2._position.x) +\r\n               Math.sqr(p1._position.y - p2._position.y)));\r\n};\r\n","/* -----------------------------------------------\r\n/* Author: Artur Zoremba (Skor_X) - skorx.ga\r\n/* MIT license: http://opensource.org/licenses/MIT\r\n/* GitHub: https://github.com/SkorX/Super-Particles\r\n/* Page: https://skorx.github.io/Super-Particles\r\n/* v0.2.0\r\n/* ----------------------------------------------- */\r\n\r\n// --- OPTIONS EXPLANATION (with default values) (do not uncomment this code, preview only) ---\r\n// {\r\n//     particles: {\r\n//         count:                   0,              (number, (0 <= val))\r\n//\r\n//         shapeType:               \"none\",         (string, (\"none\" | \"circle\" | \"square\"))\r\n//         shapeSize:               25,             (number, (0 <= val))\r\n//         shapeColor:              \"#FFFFFF\",      (string, [#colorString])\r\n//\r\n//         strokeWidth:             0,              (number, (0 <= val))\r\n//         strokeColor:             \"#000000\",      (string, [#colorString])\r\n//\r\n//         image:                   undefined,      (undefined | HTMLImageElement)\r\n//         imageSize:               15,             (number, (0 <= val))\r\n//         imageOpacity:            1,              (number, (0 <= val <= 1))\r\n//\r\n//         speed:                   8,              (number, (0 <= val))\r\n//         min_speed:               undefined,      (undefined | number, number: (0 < val < speed)\r\n//         bouncing:                true,           (boolean)\r\n//         collisionSlowdown:       false,          (boolean)\r\n//          \r\n//         direction:               undefined,      (undefined | string, string: (\"top\" | \"bottom\" | \"left\" | \"right\" | \"topleft\" ...))\r\n//         vx:                      undefined,      (undefined | number, number: (-1 <= val <= 1))\r\n//         vy:                      undefined,      (undefined | number, number: (-1 <= val <= 1))\r\n//         vx_min:                  undefined,      (undefined | number, number: (-1 <= val < vx))\r\n//         vy_min:                  undefined,      (undefined | number, number: (-1 <= val < vy))\r\n//\r\n//         opacity:                 1,              (number, (0 < val <= 1))\r\n//     }\r\n//     linking: {\r\n//         enabled:                 true,           (boolean)\r\n//         max_distance:            150,            (number, (0 < val))\r\n//         color:                   \"#FFFFFF\",      (string, [#colorString])\r\n//         width:                   1.5,            (number, (0 < val))\r\n//         opacity:                 0.6,            (number, (0 < val <= 1))\r\n//     }\r\n//     attraction: {\r\n//         enabled:                 true            (boolean)\r\n//         force:                   500,            (number)\r\n//     }\r\n//\r\n//     smoothImages:                false,          (boolean)\r\n//\r\n//     background: {\r\n//         color:                   undefined,      (undefined | string, string: [#colorString])\r\n//         image:                   undefined,      (undefined | HTMLImageElement)\r\n//     }\r\n//\r\n//     limit30FPS:                  false,          (boolean)\r\n// }\r\n\r\nvar SuperParticles = function (canvas, options) {\r\n    \"use strict\";\r\n\r\n    //init checks\r\n    if (!(this instanceof SuperParticles))\r\n        throw new Error(\"SuperParticles have to be executed as a class. Use new keyword.\");\r\n\r\n    if (!(canvas instanceof HTMLCanvasElement))\r\n        throw new Error(\"Passed canvas element have to be HTMLCanvasElement.\");\r\n\r\n    if (typeof options !== \"object\")\r\n        throw new Error(\"Options are not valid object element.\");\r\n\r\n    //// === PRIVATE VARIABLES ===\r\n    this._initialized = false;\r\n\r\n    //defaults\r\n    this._settings = {\r\n        particles: {\r\n            count: 0,\r\n        \r\n            properties: {\r\n                shape: {\r\n                    type: \"none\",               //none | circle | square\r\n                    size: 25,                   //pixels\r\n                    color: \"#FFFFFF\",\r\n\r\n                    stroke: {\r\n                        width: 0,\r\n                        color: \"#000000\",\r\n                    },\r\n                },\r\n                image: {\r\n                    data:    undefined,         //HTMLCanvasElement\r\n                    size:    15,                //width of image in pixels (height is calculted using image's aspect ratio)\r\n                    opacity: 1,\r\n                },\r\n\r\n                motion: {\r\n                    speed:     8,               //number of pixels per second\r\n                    min_speed: undefined,       //minmal particle speed (undefined = no randomness)\r\n\r\n                    bouncing:            true,  //determines if particles will be able to bounce on canvas borders\r\n                    slowDownOnCollision: false, //forces particles to keep it's speed (and only change direction)\r\n\r\n                    direction: undefined,       //undefined (no direction) or \"top\" | \"bottom\" | \"left\" | \"right\" | \"topleft\" | \"topright\" | \"bottomleft\" | \"bottomright\"\r\n                    vx:        undefined,       //initial X velocity in range <-1;1> (undefined = random)\r\n                    vy:        undefined,       //initial Y velocity in range <-1;1> (undefined = random)\r\n                    vx_min:    undefined,       //minimal X velocity in range <-1;1> (work only when vx is not undefined)\r\n                    vy_min:    undefined,       //minimal Y velocity in range <-1;1> (work only when vy is not undefined)\r\n                },\r\n\r\n                opacity: {\r\n                    value: 1,                   //particle opacity\r\n\r\n                    alternation: {\r\n                        enabled:   false,\r\n                        speed:     1,           //change per second\r\n                        min_value: 0,\r\n                    }\r\n                }\r\n            },\r\n\r\n            smoothImages: false,\r\n        },\r\n\r\n        linking: {\r\n            enabled:      true,\r\n            max_distance: 150,                  //max distance in pixels (to draw a link line)\r\n            color:        \"#FFFFFF\",\r\n            width:        1.5,\r\n            opacity:      0.6,\r\n        },\r\n        attraction: {\r\n            enabled: true,\r\n            force: 500,\r\n        },\r\n\r\n        background: {\r\n            color: undefined,\r\n            image: undefined,                   //HTMLImageElement\r\n\r\n            _imagePosition: {\r\n                x: 0,\r\n                y: 0,\r\n                width: 0,\r\n                height: 0,\r\n            }\r\n        }\r\n\r\n        //TODO some interactivity options\r\n    };\r\n\r\n    //canvas data\r\n    this._canvas = {\r\n        element: undefined,\r\n        ctx:     undefined,\r\n\r\n        width:   0,\r\n        height:  0,\r\n\r\n        drawing: {\r\n            stop:         true,             //true, because it's initial state of uninitialized engine\r\n            limitTo30FPS: false,\r\n\r\n            isResizeEventRunning: false,\r\n            lastWindowResizeTime: Date.now(),\r\n        }\r\n    };\r\n\r\n    //particles list\r\n    this._particlesCount = 0;\r\n    this._particles = [];\r\n\r\n    //callbacks\r\n    this._callbacks = {\r\n        initialized:   [],\r\n        windowResized: [],\r\n        diagnostics:   [],\r\n\r\n        //one time callbacks (for internal use)\r\n        _initialized:   undefined,\r\n        _windowResized: undefined,\r\n        _diagnostics:   undefined,\r\n    };\r\n\r\n    //keyboard data (shortcuts, etc.)\r\n    this._keyboard = {\r\n        queue: [],\r\n    }\r\n\r\n    //diagnostic data\r\n    this._diagData = {\r\n        fps:       0,           //current FPS\r\n        frame:     0,           //frame id\r\n        count:     0,           //particles count\r\n        startTime: Date.now(),  //drawing start time (new for each restart)\r\n\r\n        _times: [],             //frames times\r\n    };\r\n\r\n\r\n    //// === PUBLIC VARIABLES ===\r\n    //events\r\n    this.onInitialized   = undefined;       //()\r\n    this.onWindowResized = undefined;       //()\r\n    this.onDiagnostics   = undefined;       //(diagnosticData)\r\n\r\n    \r\n    //// === EVENT HANDLERS ===\r\n    this._resizeHandler = function () {\r\n        //handler specially made to prevent constant redrawing on resize and prevent flickering on fast computers / browsers\r\n\r\n        this._canvas.drawing.lastWindowResizeTime = Date.now();\r\n\r\n        if (!this._canvas.drawing.isResizeEventRunning) {\r\n            this._canvas.drawing.isResizeEventRunning = true;\r\n\r\n            setTimeout(this._resizeEventProcess, 50);\r\n        }\r\n    }.bind(this);\r\n\r\n    this._resizeEventProcess = function () {\r\n        if (this._canvas.drawing.isResizeEventRunning && this._canvas.drawing.lastWindowResizeTime + 50 > Date.now()) {\r\n            setTimeout(this._resizeEventProcess, 50);                                   //we are still waiting\r\n            return;                                                                     //as we will call this function later we can close this right now\r\n        }\r\n\r\n        this._drawing_ClearCanvas();\r\n\r\n        //applying (removing) some size changing styles\r\n        this._canvas.element.style.boxSizing = \"content-box\";\r\n        this._canvas.element.style.padding   = \"0\";\r\n\r\n        //setting new canvas dimensions (we can do this even when editor is locked)\r\n        this._canvas.width  = this._canvas.element.width  = this._canvas.element.offsetWidth;\r\n        this._canvas.height = this._canvas.element.height = this._canvas.element.offsetHeight;\r\n\r\n        //background image position recalculation\r\n        if (this._settings.background.image) {\r\n            var canvasRatio = this._canvas.width / this._canvas.height;\r\n            var imageRatio  = this._settings.background.image.naturalWidth / this._settings.background.image.naturalHeight;\r\n\r\n            if (canvasRatio === imageRatio) {               //image same as canvas (fill whole canvas)\r\n                this._settings.background._imagePosition = {\r\n                    x:      0,\r\n                    y:      0,\r\n                    width:  this._canvas.width,\r\n                    height: this._canvas.height\r\n                };\r\n            }\r\n            else if (canvasRatio > imageRatio) {            //image more more portrait than canvas (fill on Y, center on X)\r\n                var centerX             = Math.round(this._canvas.width / 2);\r\n                var dimensionMultiplier = this._canvas.height / this._settings.background.image.naturalHeight;\r\n                var halfBackground      = Math.floor((this._settings.background.image.width * dimensionMultiplier) / 2);\r\n                \r\n                this._settings.background._imagePosition = {\r\n                    x:      0,\r\n                    y:  centerX - halfBackground,\r\n                    width:  Math.floor(this._settings.background.image.width * dimensionMultiplier),\r\n                    height: this._canvas.height\r\n                };\r\n            }\r\n            else {                                          //image more more landscape than canvas (fill on X, center on Y)\r\n                var centerY             = Math.round(this._canvas.height / 2);\r\n                var dimensionMultiplier = this._canvas.width / this._settings.background.image.width;\r\n                var halfBackground      = Math.floor((this._settings.background.image.height * dimensionMultiplier) / 2);\r\n    \r\n                this._settings.background._imagePosition = {\r\n                    x:      centerY - halfBackground,\r\n                    y:      0,\r\n                    width:  this._canvas.width,\r\n                    height: Math.floor(this._settings.background.image.height * dimensionMultiplier)\r\n                };\r\n            }\r\n        }\r\n\r\n        //particles recalculation\r\n        for (var i = 0; i < this._particles.length; i++) {\r\n            this._particles[i].checkPosition(this._canvas.width, this._canvas.height);\r\n        }\r\n\r\n        this._canvas.element.style.visibility     = \"visible\";\r\n        this._canvas.drawing.isResizeEventRunning = false;\r\n\r\n        this._handleEvent('windowResized');\r\n    }.bind(this);\r\n    \r\n    //keyboard, mouse & touch\r\n    this._keyDownHandler = function (e) {\r\n        if (this._kc(e))\r\n        return;\r\n\r\n        //DBG\r\n        //this._requestFrame(this._process);\r\n    }.bind(this);\r\n    \r\n    this._kc = function (kbEvent) {\r\n        this._keyboard.queue.push(kbEvent.keyCode);\r\n        \r\n        if (this._keyboard.queue.length > 10)\r\n        this._keyboard.queue.shift();\r\n        \r\n        if (this._keyboard.queue.toString() === \"38,38,40,40,37,39,37,39,66,65\") {\r\n            //TODO Konami Code handling\r\n            \r\n            return true;\r\n        }\r\n        \r\n        return false;\r\n    }.bind(this);\r\n    \r\n    \r\n    //// === CONSTRUCTOR ===\r\n    this._canvas.element = canvas;\r\n    this._canvas.ctx = canvas.getContext(\"2d\");\r\n\r\n    this._canvas.width  = this._canvas.element.width  = this._canvas.element.offsetWidth;\r\n    this._canvas.height = this._canvas.element.height = this._canvas.element.offsetHeight;\r\n\r\n    //loading options passed by user\r\n    this._loadOptions(options);\r\n\r\n    //filling engine with particles\r\n    //TODO\r\n\r\n    //events attach\r\n    window.addEventListener('keydown', this._keyDownHandler);\r\n    window.addEventListener('resize',  this._resizeHandler);\r\n    this._resizeHandler();\r\n\r\n    //marking particles as prepared to run\r\n    this._initialized = true;\r\n    this.startDrawing();\r\n\r\n    return this;\r\n};\r\nSuperParticles.version = {\r\n    major:    0,\r\n    minor:    2,\r\n    revision: 0,\r\n    beta:  true,\r\n};\r\n\r\n//// === PUBLIC METHODS ===\r\n//particles\r\nSuperParticles.prototype.addParticle = function (particle, position) {\r\n    if (!(particle instanceof SuperParticle))\r\n        throw new Error(\"Particle have to be a SuperParticle instance.\");\r\n\r\n    if (typeof position === \"number\") {\r\n        //adding particle at specific position in collection\r\n        this._particles.splice(position, 0, particle);\r\n    } else {\r\n        //adding particle at the end of collection\r\n        this._particles.push(particle);\r\n    }\r\n\r\n    //updating particles count\r\n    this._particlesCount = this._particles.length;\r\n    return this;\r\n};\r\n\r\nSuperParticles.prototype.removeParticle = function (particle) {\r\n    if (particle === true) {\r\n        //removing last particle\r\n        this._particles.pop();\r\n\r\n        //updating particles count\r\n        this._particlesCount = this._particles.length;\r\n        return this;\r\n    }\r\n    else if (particle instanceof SuperParticle) {\r\n        //removing specified particle\r\n        var index = this._particles.indexOf(particle);\r\n        if (index !== -1)\r\n            this._particles.splice(index, 1);\r\n        \r\n        //updating particles count\r\n        this._particlesCount = this._particles.length;\r\n        return this;\r\n    }\r\n\r\n    throw new Error(\"Particle have to be a SuperParticle instance.\");\r\n};\r\n\r\n//events\r\nSuperParticles.prototype.addEventListener = function (event, callback) {\r\n    if (typeof event !== 'string' || typeof callback !== 'function')\r\n        return this;\r\n\r\n    if (!event.startsWith('_') && event in this._callbacks) {\r\n        this._callbacks[event].push(callback);\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticles.prototype.removeEventListener = function (event, callback) {\r\n    if (typeof event !== 'string' || typeof callback !== 'function')\r\n        return this;\r\n\r\n    if (!event.startsWith('_') && event in this._callbacks) {\r\n        var index = this._callbacks[event].indexOf(callback);\r\n\r\n        if (index !== -1)\r\n        this._callbacks[event].splice(index, 1);\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\n//drawing\r\nSuperParticles.prototype.startDrawing = function () {\r\n    if (!this._canvas.drawing.stop || !this._initialized)       //preventing animation, if drawing loop is running or engine is not initialized\r\n        return this;\r\n\r\n    this._canvas.drawing.stop = false;\r\n    this._diagData.startTime = Date.now();\r\n    this._requestFrame(this._process);\r\n\r\n    return this;\r\n};\r\n\r\nSuperParticles.prototype.stopDrawing = function () {\r\n    this._canvas.drawing.stop = true;\r\n\r\n    return this;\r\n};\r\n\r\n//image export\r\nSuperParticles.prototype.getScreenshotData = function (callback, format, encoderOptions) {          //callback (imageData: base64 string | false)\r\n    if (!this._initialized) {\r\n        this._execCallback(callback, [false]);\r\n        return that;\r\n    }\r\n\r\n    var imgData = this._canvas.element.toDataURL(format, encoderOptions);\r\n    this._execCallback(callback, [imgData]);\r\n\r\n    return that;\r\n};\r\n\r\nSuperParticles.prototype.getScreenshot = function (callback) {                                      //callback (image: HTMLImageElement | false)\r\n    if (typeof callback !== 'function')\r\n        throw new Error(\"Callback parameter is not a function.\");\r\n\r\n    this.getScreenshotData(function (imageData) {\r\n        if (imageData === false) {\r\n            this._execCallback(callback, [false]);\r\n            return this;\r\n        }\r\n    });\r\n\r\n    var image = document.createElement(\"img\");\r\n    image.onload = function () { this._execCallback(callback, [image]); }.bind(this);\r\n    image.src = imageData;\r\n\r\n    return this;\r\n};\r\n\r\n\r\n//// === PRIVATE METHODS ===\r\n//options\r\nSuperParticles.prototype._loadOptions = function (options) {\r\n    if (typeof options !== 'object')\r\n        return false;\r\n\r\n    var previousState = this._engineState();\r\n\r\n    //particles\r\n    if (typeof options.particles === \"object\") {\r\n        //count\r\n        if ('count'             in options.particles && isFinite(options.particles.count)) {\r\n            if (options.particles.count >= 0)\r\n                this._settings.particles.count = options.particles.count;\r\n        }\r\n\r\n        //shape & stroke\r\n        if ('shapeType'         in options.particles && typeof options.particles.shapeType === \"string\") {\r\n            switch (options.particles.shapeType) {\r\n                case \"circle\":\r\n                    this._settings.particles.properties.shape.type = \"circle\";\r\n                    break;\r\n\r\n                case \"square\":\r\n                    this._settings.particles.properties.shape.type = \"square\";\r\n                    break;\r\n\r\n                case \"none\":\r\n                default:\r\n                    this._settings.particles.properties.shape.type = undefined;\r\n            }\r\n        }\r\n\r\n        if ('shapeSize'         in options.particles && isFinite(options.particles.shapeSize)) {\r\n            if (options.particles.shapeSize >= 0)\r\n                this._settings.particles.properties.shape.size = options.particles.shapeSize;\r\n        }\r\n\r\n        if ('shapeColor'        in options.particles && typeof options.particles.shapeColor === \"string\")\r\n            this._settings.particles.properties.shape.color = options.particles.shapeColor;\r\n\r\n        if ('strokeWidth'       in options.particles && isFinite(options.particles.strokeWidth)) {\r\n            if (options.particles.strokeWidth >= 0)\r\n                this._settings.particles.properties.shape.stroke.width = options.particles.strokeWidth;\r\n        }\r\n\r\n        if ('strokeColor'       in options.particles && typeof options.particles.strokeColor === \"string\")\r\n            this._settings.particles.properties.shape.stroke.color = options.particles.strokeColor;\r\n\r\n        //image\r\n        if ('image'             in options.particles) {\r\n            if (options.particles.image instanceof HTMLImageElement) {\r\n                try {\r\n                    var image = Images.getCanvasForImage(options.particles.image);\r\n                    this._settings.particles.properties.image.data = image;\r\n                }\r\n                catch (e) {\r\n                    //broken image :|\r\n                    console.log(\"Particle image is unusable. Image won't be stored.\");\r\n                }\r\n            }\r\n            else if (!options.particles.image) {\r\n                this._settings.particles.properties.image.data = undefined;\r\n            }\r\n        }\r\n\r\n        if ('imageSize'         in options.particles && isFinite(options.particles.imageSize)) {\r\n            if (options.particles.imageSize >= 0)\r\n                this._settings.particles.properties.image.size = options.particles.imageSize;\r\n        }\r\n\r\n        if ('imageOpacity'      in options.particles && isFinite(options.particles.imageOpacity)) {\r\n            if (options.particles.imageOpacity >= 0 && options.particles.imageOpacity <= 1)\r\n                this._settings.particles.properties.image.opacity = options.particles.imageOpacity;\r\n        }\r\n\r\n        //motion\r\n        if ('speed'             in options.particles && isFinite(options.particles.speed)) {\r\n            if (options.particles.speed >= 0) {\r\n                this._settings.particles.properties.motion.speed = options.particles.speed;\r\n\r\n                if (this._settings.particles.properties.motion.min_speed >= this._settings.particles.properties.motion.speed)\r\n                    this._settings.particles.properties.motion.min_speed = undefined;\r\n            }\r\n        }\r\n\r\n        if ('min_speed'         in options.particles && isFinite(options.particles.min_speed)) {\r\n            if (options.particles.min_speed >= 0 && options.particles.min_speed < this._settings.particles.properties.motion.speed)\r\n                this._settings.particles.properties.motion.min_speed = options.particles.min_speed;\r\n        }\r\n\r\n        if ('bouncing'          in options.particles && typeof options.particles.bouncing === \"boolean\")\r\n            this._settings.particles.properties.motion.bouncing = options.particles.bouncing;\r\n\r\n        if ('collisionSlowdown' in options.particles && typeof options.particles.collisionSlowdown === \"boolean\")\r\n            this._settings.particles.properties.motion.slowDownOnCollision = options.particles.collisionSlowdown;\r\n\r\n        if ('direction'         in options.particles) {\r\n            if (typeof options.particles.direction === \"string\") {\r\n                switch (options.particles.direction) {\r\n                    case \"top\":\r\n                    case \"bottom\":\r\n                    case \"left\":\r\n                    case \"right\":\r\n                    case \"topleft\":\r\n                    case \"topright\":\r\n                    case \"bottomleft\":\r\n                    case \"bottomright\":\r\n                        this._settings.particles.properties.motion.direction = options.particles.direction;\r\n                        break;\r\n\r\n                    case \"none\":\r\n                        this._settings.particles.properties.motion.direction = undefined;\r\n                        break;\r\n                }\r\n            }\r\n            else if (typeof options.particles.direction === \"undefined\") {\r\n                this._settings.particles.properties.motion.direction = undefined;\r\n            }\r\n        }\r\n\r\n        if ('vx'                in options.particles && isFinite(options.particles.vx)) {\r\n            if (options.particles.vx >= -1 && options.particles.vx <= 1) {\r\n                this._settings.particles.properties.motion.vx = options.particles.vx;\r\n\r\n                if (this._settings.particles.properties.motion.vx_min >= options.particles.vx)\r\n                    this._settings.particles.properties.motion.vx_min = undefined;\r\n            }\r\n        }\r\n\r\n        if ('vy'                in options.particles && isFinite(options.particles.vy)) {\r\n            if (options.particles.vy >= -1 && options.particles.vy <= 1) {\r\n                this._settings.particles.properties.motion.vy = options.particles.vy;\r\n\r\n                if (this._settings.particles.properties.motion.vy_min >= options.particles.vy)\r\n                    this._settings.particles.properties.motion.vy_min = undefined;\r\n            }\r\n        }\r\n\r\n        if ('vx_min'            in options.particles && isFinite(options.particles.vx_min)) {\r\n            if (options.particles.vx_min >= -1 && options.particles.vx_min < this._settings.particles.properties.motion.vx)\r\n                this._settings.particles.properties.motion.vx_min = options.particles.vx_min;\r\n        }\r\n\r\n        if ('vy_min'            in options.particles && isFinite(options.particles.vy_min)) {\r\n            if (options.particles.vy_min >= -1 && options.particles.vy_min < this._settings.particles.properties.motion.vx)\r\n                this._settings.particles.properties.motion.vy_min = options.particles.vy_min;\r\n        }\r\n\r\n        if ('opacity'           in options.particles && isFinite(options.particles.opacity)) {\r\n            if (options.particles.opacity > 0 && options.particles.opacity <= 1)\r\n                this._settings.particles.properties.opacity.value = options.particles.opacity;\r\n        }\r\n    }\r\n\r\n    //linking\r\n    if (typeof options.linking === \"object\") {\r\n        if ('enabled'       in options.linking && typeof options.linking.enabled === \"boolean\")\r\n            this._settings.linking.enabled = options.linking.enabled;\r\n\r\n        if ('max_distance'  in options.linking && isFinite(options.linking.max_distance)) {\r\n            if (options.linking.max_distance > 0)\r\n                this._settings.linking.max_distance = options.linking.max_distance;\r\n        }\r\n\r\n        if ('color'         in options.linking && typeof options.linking.color === \"string\")\r\n            this._settings.linking.color = options.linking.color;\r\n\r\n        if ('width'         in options.linking && isFinite(options.linking.width)) {\r\n            if (options.linking.width > 0)\r\n                this._settings.linking.width = options.linking.width;\r\n        }\r\n\r\n        if ('opacity'       in options.linking && isFinite(options.linking.opacity)) {\r\n            if (options.linking.opacity > 0 && options.linking.opacity <= 1)\r\n                this._settings.linking.opacity = options.linking.opacity;\r\n        }\r\n    }\r\n\r\n    //attraction\r\n    if (typeof options.attraction === \"object\") {\r\n        if ('enabled'   in options.attraction && typeof options.attraction.enabled === \"boolean\")\r\n            this._settings.attraction.enabled = options.attraction.enabled;\r\n\r\n        if ('force'     in options.attraction && isFinite(options.attraction.force))\r\n            this._settings.attraction.force = options.attraction.force;\r\n    }\r\n\r\n    //smoothing\r\n    if ('smoothImages'  in options && typeof options.smoothImages === \"boolean\")\r\n        this._settings.particles.smoothImages = options.smoothImages;\r\n\r\n    //background\r\n    if (typeof options.background === \"object\") {\r\n        if ('color'     in options.background) {\r\n            if (typeof options.background.color === \"string\")\r\n                this._settings.background.color = options.background.color;\r\n            else if (!options.background.color)\r\n                this._settings.background.color = undefined;\r\n        }\r\n\r\n        if ('image'     in options.background) {\r\n            if (options.background.image instanceof HTMLImageElement) {\r\n                try {\r\n                    var image = Images.getCanvasForImage(options.background.image);\r\n                    this._settings.background.image = image;\r\n                }\r\n                catch (e) {\r\n                    //broken image :|\r\n                    console.log(\"Background image is unusable. Image won't be stored.\");\r\n                }\r\n            }\r\n            else if (!options.background.image) {\r\n                this._settings.background.image = undefined;\r\n            }\r\n        }\r\n    }\r\n\r\n    //FPS limiting\r\n    if ('limit30FPS'    in options && typeof options.limit30FPS === \"boolean\")\r\n        this._canvas.drawing.limitTo30FPS = options.limit30FPS;\r\n\r\n    this._updateParticles(previousState, this._engineState());\r\n    return true;\r\n};\r\n\r\nSuperParticles.prototype._updateParticles = function (prevState, currentState) {\r\n    var countDiff = currentState.particles.count - prevState.particles.count;\r\n    var engineParticles = this._getEngineGeneratedParticles();\r\n\r\n    if (countDiff > 0) {\r\n        //adding new particles\r\n        while (countDiff--) {\r\n            this.addParticle(this._generateParticle());\r\n        }\r\n    }\r\n    else if (countDiff < 0) {\r\n        //removing last engine particles (by diff)\r\n        countDiff = Math.abs(countDiff);    //we need positive value ;)\r\n        var particlesToRemove = engineParticles.splice(engineParticles.length - countDiff, countDiff);\r\n\r\n        for (var i = 0; i < particlesToRemove.length; i++) {\r\n            this.removeParticle(particlesToRemove[i]);\r\n        }\r\n    }\r\n\r\n    //TODO update current engineParticles\r\n};\r\n\r\n//particles list / genetation / etc.\r\nSuperParticles.prototype._getEngineGeneratedParticles = function () {\r\n    var result = [];\r\n    var count = this._particles.length;\r\n\r\n    for (var i = 0; i < count; i++) {\r\n        if (typeof this._particles[i].tag === \"undefined\")\r\n            result.push(this._particles[i]);\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nSuperParticles.prototype._generateParticle = function () {\r\n    //TODO \r\n};\r\n\r\n//state\r\nSuperParticles.prototype._engineState = function () {\r\n    var particlesImage, backgroundImage;\r\n\r\n    //praparing data which may be undefined\r\n    if (this._settings.particles.properties.image.data)\r\n        particlesImage = this._settings.particles.properties.image.data.toDataURL();\r\n        \r\n    if (this._settings.background.image)\r\n        backgroundImage = this._settings.background.image.toDataURL();\r\n\r\n    //generating engine state\r\n    return JSON.parse(JSON.stringify({\r\n        particles: {\r\n            count: this._settings.particles.count,\r\n            shape: this._settings.particles.properties.shape,\r\n            image: {\r\n                data: particlesImage,\r\n                size: this._settings.particles.properties.image.size,\r\n                opacity: this._settings.particles.properties.image.opacity,\r\n            },\r\n            motion: this._settings.particles.properties.motion,\r\n            opacity: this._settings.particles.properties.opacity,\r\n            smoothImages: this._settings.particles.smoothImages,\r\n        },\r\n        linking: this._settings.linking,\r\n        attraction: this._settings.attraction,\r\n        background: {\r\n            color: this._settings.background.color,\r\n            image: backgroundImage,\r\n        },\r\n\r\n        drawing: {\r\n            stop: this._canvas.drawing.stop,\r\n            limitTo30FPS: this._canvas.drawing.limitTo30FPS,\r\n        },\r\n\r\n        frame: this._diagData.frame,\r\n    }));\r\n};\r\n\r\nSuperParticles.prototype._particlesState = function () {\r\n    var particlesState = [];\r\n\r\n    for (var i = 0; i < this._particles.length; i++) {\r\n        particlesState.push(this._particles[i].getState());\r\n    }\r\n};\r\n\r\n//callbacks & events\r\nSuperParticles.prototype._handleEvent = function (eventName, argArray, disableInner, disablePublic) {\r\n    if (typeof eventName !== 'string')\r\n        throw new Error(\"_handleEvent - Event name have to be a string value.\");\r\n\r\n    disableInner  = (typeof disableInner  !== 'boolean') ? false : disableInner;\r\n    disablePublic = (typeof disablePublic !== 'boolean') ? false : disablePublic;\r\n\r\n    if (!disableInner) {\r\n        var privateName = \"_\" + eventName;\r\n        \r\n        //executing internal callbacks (first, no async)\r\n        if (privateName in this._callbacks && typeof this._callbacks[privateName] === 'function')\r\n            this._callbacks[privateName].apply(this, argArray);\r\n    }\r\n    \r\n    if (!disablePublic) {\r\n        var publicName = \"on\" + eventName.charAt(0).toUpperCase() + eventName.slice(1);\r\n\r\n        //executing public callbacks (from array)\r\n        if (eventName in this._callbacks) {        //don't have to check for function type (addEventListener do this)\r\n            for (var i = 0; i < this._callbacks[eventName].length; i++) {\r\n                setTimeout(function (id) { (this._callbacks[eventName][id]).apply(this, argArray); }.bind(this), undefined, i);\r\n            }\r\n        }\r\n\r\n        //executing public callback (on... named)\r\n        if (publicName in this && typeof this[publicName] === 'function')\r\n            setTimeout(function () { (this[publicName]).apply(this, argArray); }.bind(this));\r\n    }\r\n};\r\n\r\nSuperParticles.prototype._execCallback = function (callback, args) {\r\n    if (typeof callback !== 'function')\r\n        throw new Error(\"Callback parameter is not a function.\");\r\n\r\n    try {\r\n        setTimeout(function () { callback.apply(this, args); }.bind(this));\r\n    }\r\n    catch (e) {\r\n        console.exception(\"An error was thrown during callback: \" + e.message || e);\r\n    }\r\n};\r\n\r\n//drawing\r\nSuperParticles.prototype._requestFrame = function (callback) {\r\n    if (window.requestAnimationFrame)               window.requestAnimationFrame(callback.bind(this));\r\n    else if (window.mozRequestAnimationFrame)       window.mozRequestAnimationFrame(callback.bind(this));\r\n    else if (window.webkitRequestAnimationFrame)    window.webkitRequestAnimationFrame(callback.bind(this));\r\n    else if (window.oRequestAnimationFrame)         window.oRequestAnimationFrame(callback.bind(this));\r\n    else if (window.msRequestAnimationFrame)        window.msRequestAnimationFrame(callback.bind(this));\r\n    else\r\n        throw new Error(\"Can't redraw canvas, because browser do not support any requestAnimationFrame method.\");\r\n};\r\n\r\nSuperParticles.prototype._process = function () {\r\n    if (this._canvas.drawing.stop)          //preventing particles processing when animation should be stopped\r\n        return;\r\n\r\n    this._particlesCount = this._particles.length;\r\n\r\n    //logic / particles processing\r\n    for (var i = 0; i < this._particlesCount; i++) {\r\n        //particles interactions\r\n        for (var j = i + 1; j < this._particlesCount; j++) {\r\n            //attration\r\n            this._particles[i].attractTo(this._particles[j]);\r\n        }\r\n\r\n        this._particles[i].checkPosition(this._canvas.width, this._canvas.height);\r\n        this._particles[i].update();\r\n    }\r\n\r\n    this._drawing_Redraw();\r\n    this._drawing_Diagnostic();\r\n\r\n    //request next animation frame\r\n    this._requestFrame(this._process);\r\n};\r\n\r\nSuperParticles.prototype._drawing_Redraw = function () {\r\n    if (this._canvas.drawing.limitTo30FPS && this._diagData.frame % 2 != 0)\r\n        return;\r\n\r\n    //clear canvas / draw canvas background\r\n    this._drawing_ClearCanvas();\r\n\r\n    for (var i = 0; i < this._particlesCount; i++) {\r\n        //line linking\r\n        if (this._settings.linking.enabled) {\r\n            var maxDistanceSqr = Math.sqr(this._settings.linking.max_distance);\r\n\r\n            for (var j = i + 1; j < this._particlesCount; j++) {\r\n                var distanceSqr =\r\n                    Math.sqr(this._particles[i]._position.x - this._particles[j]._position.x) +\r\n                    Math.sqr(this._particles[i]._position.y - this._particles[j]._position.y);\r\n\r\n                if (distanceSqr <= maxDistanceSqr) {\r\n                    this._canvas.ctx.save();\r\n                    \r\n                    this._canvas.ctx.beginPath();\r\n                    this._canvas.ctx.moveTo(this._particles[i]._position.x, this._particles[i]._position.y);\r\n                    this._canvas.ctx.lineTo(this._particles[j]._position.x, this._particles[j]._position.y);\r\n                    this._canvas.ctx.lineWidth   = this._settings.linking.width;\r\n                    this._canvas.ctx.strokeStyle = this._settings.linking.color;\r\n                    this._canvas.ctx.globalAlpha = this._settings.linking.opacity * (1 - distanceSqr / maxDistanceSqr);\r\n                    this._canvas.ctx.stroke();\r\n\r\n                    this._canvas.ctx.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        //particle drawing\r\n        this._canvas.ctx.save();\r\n        this._particles[i].draw(this._canvas.ctx, this._settings.particles.smoothImages);\r\n        this._canvas.ctx.restore();\r\n    }\r\n};\r\n\r\nSuperParticles.prototype._drawing_ClearCanvas = function () {\r\n    this._canvas.ctx.save();\r\n\r\n    if (this._settings.background.color) {\r\n        this._canvas.ctx.fillStyle             = this._settings.background.color;\r\n        this._canvas.ctx.globalAlpha           = 1.0;\r\n        this._canvas.ctx.imageSmoothingEnabled = false;\r\n        this._canvas.ctx.fillRect(0, 0, this._canvas.width, this._canvas.height);\r\n    }\r\n    else {\r\n        this._canvas.ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n    }\r\n\r\n    if (this._settings.background.image) {\r\n        this._canvas.ctx.drawImage(\r\n            this._settings.background.image,\r\n            this._settings.background._imagePosition.x,\r\n            this._settings.background._imagePosition.y,\r\n            this._settings.background._imagePosition.width,\r\n            this._settings.background._imagePosition.height);\r\n    }\r\n\r\n    this._canvas.ctx.restore();\r\n};\r\n\r\nSuperParticles.prototype._drawing_Diagnostic = function () {\r\n    //frame count & particles count\r\n    this._diagData.frame++;\r\n\r\n    if (this._canvas.drawing.limitTo30FPS && this._diagData.frame % 2 != 0)\r\n        return;\r\n        \r\n    this._diagData.count = this._particles.length;\r\n\r\n    //fps calculation\r\n    var now = performance.now();\r\n    while (this._diagData._times.length > 0 && this._diagData._times[0] <= now - 1000) {\r\n        this._diagData._times.shift();\r\n    }\r\n    this._diagData._times.push(now);\r\n\r\n    this._diagData.fps =\r\n        (this._diagData._times.length / ((now - this._diagData._times[0]) / 1000))\r\n        .toFixed(2);\r\n\r\n    //rise event\r\n    this._handleEvent(\"diagnostics\", [{\r\n        fps:       this._diagData.fps,\r\n        frame:     (this._canvas.drawing.limitTo30FPS) ? parseInt(this._diagData.frame / 2) : this._diagData.frame,\r\n        count:     this._diagData.count,\r\n        startTime: this._diagData.startTime\r\n    }]);\r\n};\r\n"]}